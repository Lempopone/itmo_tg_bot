import telebot
from telebot import types
import json
import re

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
TOKEN = '8330544117:AAEe9EViYiydDbG64MS68C0KBQsVE0bFsM0'
bot = telebot.TeleBot(TOKEN)

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —É—á–µ–±–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤
with open('ai_plan.json', 'r', encoding='utf-8') as f:
    ai_plan = json.load(f)

with open('ai_product_plan.json', 'r', encoding='utf-8') as f:
    ai_product_plan = json.load(f)

# –ü–æ–ª–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
RELEVANT_KEYWORDS = {
    'program': [
        '–∏–∏', 'ai', '–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω', '–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç', '–ø—Ä–æ–¥—É–∫—Ç', 'product',
        '–º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä', '–æ–±—É—á–µ–Ω', '–æ–±—Ä–∞–∑–æ–≤–∞–Ω', 'study', '–ø—Ä–æ–≥—Ä–∞–º–º', 'program',
        '–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω', '–æ–±—É—á–µ–Ω–∏–µ', '—É—á—ë–±', '—É—á–µ–±–Ω', '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏', 'education',
        'master', '–º–∞–≥–∏—Å—Ç—Ä', '–ø–æ—Å—Ç—É–ø–ª–µ–Ω', '–ø–æ—Å—Ç—É–ø–∏—Ç—å', '–ø–æ–¥–∞—á', '–∑–∞—è–≤–∫',
        '—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç', '–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω', 'curriculum', '–∫—É—Ä—Ä–∏–∫—É–ª—É–º', 'itmo',
        '–∏—Ç–º–æ', '—É–Ω–∏–≤–µ—Ä', '–≤—É–∑', 'univers', 'faculty', '—Ñ–∞–∫—É–ª—å—Ç–µ—Ç'
    ],
    'courses': [
        '–∫—É—Ä—Å', '–¥–∏—Å—Ü–∏–ø–ª–∏–Ω', '–ø—Ä–µ–¥–º–µ—Ç', 'elective', '–≤—ã–±–æ—Ä', '–ª–µ–∫—Ü–∏',
        '—Å–µ–º–∏–Ω–∞—Ä', '–∑–∞–Ω—è—Ç', 'class', 'module', '–º–æ–¥—É–ª', 'study plan',
        '—É—á–µ–±–Ω –ø–ª–∞–Ω', '–ø—Ä–æ–≥—Ä–∞–º–º –æ–±—É—á–µ–Ω', 'teaching', '–ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω',
        'academic', '–∞–∫–∞–¥–µ–º–∏—á', 'credit', '–∫—Ä–µ–¥–∏—Ç', 'ects', '—á–∞—Å—ã',
        'hours', '–∞—É–¥–∏—Ç–æ—Ä–Ω', 'load', '–Ω–∞–≥—Ä—É–∑–∫', 'syllabus', '—Å–∏–ª–ª–∞–±—É—Å',
        '–∫–∞—Ñ–µ–¥—Ä', 'department', 'chair', 'teacher', '–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª',
        'professor', '–ª–µ–∫—Ç–æ—Ä', 'instructor', '—Ç—Ä–µ–Ω–µ—Ä', '—É—á–∏—Ç–µ–ª'
    ],
    'structure': [
        '—Å–µ–º–µ—Å—Ç—Ä', '–≥—Ä–∞—Ñ–∏–∫', '–ø–ª–∞–Ω', '—Ä–∞—Å–ø–∏—Å–∞–Ω', '—Ç—Ä—É–¥–æ–µ–º–∫', '–ø–µ—Ä–∏–æ–¥',
        '—Å–µ–º–µ—Å—Ç—Ä–æ–≤', '–ø–æ–ª—É–≥–æ–¥–∏–µ', 'trimester', '–∫–≤–∞—Ä—Ç–∞–ª', 'quarter',
        '–≥–æ–¥', 'year', '—É—á–µ–±–Ω –≥–æ–¥', 'academic year', '—Ä–∞—Å–ø–∏—Å–∞–Ω–∏',
        'schedule', '–∫–∞–ª–µ–Ω–¥–∞—Ä', 'calendar', '–¥–∞—Ç—ã', 'dates', '–Ω–∞—á–∞–ª–æ',
        'start', '–∫–æ–Ω–µ—Ü', 'end', '–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω', 'duration', '–¥–ª–∏—Ç–µ–ª—å–Ω',
        '—Å—Ä–æ–∫', 'term', 'stage', '—ç—Ç–∞–ø', 'phase', '—á–∞—Å—Ç—å', 'part',
        '–±–ª–æ–∫', 'block', 'segment', '–º–æ–¥—É–ª', 'module', '—Ä–∞–∑–¥–µ–ª', 'section'
    ],
    'practice': [
        '–ø—Ä–∞–∫—Ç–∏–∫', '—Å—Ç–∞–∂–∏—Ä–æ–≤–∫', '—Ä–∞–±–æ—Ç', 'project', 'internship',
        '–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω', 'lab', '–ª–∞–±–∞', 'research', '–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏',
        'experiment', '—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç', '–∑–∞–¥–∞–Ω–∏', 'task', 'assignment',
        '–ø—Ä–æ–µ–∫—Ç', 'project', '–∫–µ–π—Å', 'case', '—Ä–µ—à–µ–Ω', 'solution',
        'problem', '–ø—Ä–æ–±–ª–µ–º', '–∑–∞–¥–∞—á', 'exercise', '—É–ø—Ä–∞–∂–Ω–µ–Ω',
        '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫', 'training', 'workshop', '–≤–æ—Ä–∫—à–æ–ø', '—Å–µ–º–∏–Ω–∞—Ä',
        'seminar', '–∫–æ–ª–ª–æ–∫–≤–∏—É–º', 'colloquium', '–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü', 'conference',
        '–ø—É–±–ª–∏–∫–∞—Ü', 'publication', 'article', '—Å—Ç–∞—Ç—å', 'paper', '—Ä–∞–±–æ—Ç',
        'thesis', '–¥–∏–ø–ª–æ–º', '–¥–∏—Å—Å–µ—Ä—Ç–∞—Ü', 'dissertation', 'qualification',
        '–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü', '–∞—Ç—Ç–µ—Å—Ç–∞—Ü', 'certification', '—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü'
    ],
    'recommend': [
        '–ø–æ—Å–æ–≤–µ—Ç—É–π', '—Ä–µ–∫–æ–º–µ–Ω–¥', '–≤—ã–±—Ä–∞—Ç—å', '–±—ç–∫–≥—Ä–∞—É–Ω–¥', '–æ–ø—ã—Ç',
        'background', '—Å–æ–≤–µ—Ç', 'advice', 'help', '–ø–æ–º–æ—â', '–ø–æ–¥—Å–∫–∞–∂',
        'suggest', '–ø—Ä–µ–¥–ª–æ–∂', '–æ—Ä–∏–µ–Ω—Ç–∏—Ä', '–æ—Ä–∏–µ–Ω—Ç–∞—Ü', 'guidance',
        '—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤', '–∏–Ω—Å—Ç—Ä—É–∫—Ü', 'instruction', 'manual', '–≥–∞–π–¥',
        'guide', 'tutorial', '–æ–±—É—á–µ–Ω', 'teach', 'study', '–∏–∑—É—á–µ–Ω',
        'learn', '–∫–∞–∫ –ª—É—á—à', 'how to', '—á—Ç–æ –ª—É—á—à', 'what is better',
        'compare', '—Å—Ä–∞–≤–Ω–µ–Ω', 'difference', '—Ä–∞–∑–ª–∏—á', '–æ—Ç–ª–∏—á',
        'similar', '–ø–æ—Ö–æ–∂', '–∞–Ω–∞–ª–æ–≥', 'analog', '–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç', 'alternative',
        '–≤—ã–±–æ—Ä', 'choice', 'select', '–ø–æ–¥–±–æ—Ä', '–ø–æ–¥—Ö–æ–¥—è—â', 'suitable',
        '—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤', 'match', '—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤', '—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤', 'fit', '–ø–æ–¥—Ö–æ–¥',
        'approach', '—Å—Ç—Ä–∞—Ç–µ–≥', 'strategy', '—Ç–∞–∫—Ç–∏–∫', 'tactic', '–ø–ª–∞–Ω',
        'plan', '–∫—É—Ä—Å', 'path', '–ø—É—Ç—å', 'roadmap', '–¥–æ—Ä–æ–∂–Ω –∫–∞—Ä—Ç'
    ],
    'assessment': [
        '—ç–∫–∑–∞–º–µ–Ω', 'exam', '–∑–∞—á–µ—Ç', 'test', '—Ç–µ—Å—Ç', '–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω',
        '–∞—Ç—Ç–µ—Å—Ç–∞—Ü', 'assessment', '–æ—Ü–µ–Ω–∫', 'grade', '–±–∞–ª–ª', 'score',
        '—Ä–µ–π—Ç–∏–Ω–≥', 'rating', '—Å–∏—Å—Ç–µ–º –æ—Ü–µ–Ω', 'grading', '—à–∫–∞–ª',
        'scale', '–∫—Ä–∏—Ç–µ—Ä–∏', 'criterion', 'requirement', '—Ç—Ä–µ–±–æ–≤–∞–Ω',
        '—É—Å–ª–æ–≤', 'condition', '–Ω–æ—Ä–º–∞—Ç–∏–≤', 'standard', '—Å—Ç–∞–Ω–¥–∞—Ä—Ç',
        '–ø—Ä–∞–≤–∏–ª', 'rule', 'regulation', '—Ä–µ–≥–ª–∞–º–µ–Ω—Ç', 'procedure',
        '–ø—Ä–æ—Ü–µ–¥—É—Ä', '–ø–æ—Ä—è–¥–æ–∫', 'order', 'process', '–ø—Ä–æ—Ü–µ—Å—Å'
    ],
    'career': [
        '–∫–∞—Ä—å–µ—Ä', 'career', '—Ä–∞–±–æ—Ç', 'job', '—Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤', 'employment',
        '–≤–∞–∫–∞–Ω—Å', 'vacancy', '–∫–æ–º–ø–∞–Ω–∏', 'company', '–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü', 'organization',
        '–ø—Ä–µ–¥–ø—Ä–∏—è—Ç', 'enterprise', 'business', '–±–∏–∑–Ω–µ—Å', '—Å—Ç–∞—Ä—Ç–∞–ø', 'startup',
        '–ø—Ä–æ—Ñ–µ—Å—Å', 'profession', '–¥–æ–ª–∂–Ω–æ—Å—Ç', 'position', '–∑–∞–Ω—è—Ç–æ—Å—Ç',
        'employment', '–∑–∞—Ä–∞–±–æ—Ç–Ω', 'salary', '–¥–æ—Ö–æ–¥', 'income', '–ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤',
        'perspective', '–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç', 'opportunity', '–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª', 'potential',
        '—Ä–∞–∑–≤–∏—Ç', 'development', 'growth', '—Ä–æ—Å—Ç', '—É—Å–ø–µ—Ö', 'success',
        '–¥–æ—Å—Ç–∏–∂–µ–Ω', 'achievement', '—Ü–µ–ª—å', 'goal', 'target', '–º–∏—à–µ–Ω',
        'objective', '–∑–∞–¥–∞—á', 'task', '–ø–ª–∞–Ω', 'plan', '—Å—Ç—Ä–∞—Ç–µ–≥', 'strategy'
    ],
    'admission': [
        '–ø–æ—Å—Ç—É–ø–ª–µ–Ω', 'admission', '–ø–æ–¥–∞—á', 'application', '–∑–∞—è–≤–∫', 'request',
        '–¥–æ–∫—É–º–µ–Ω—Ç', 'document', '—Ç—Ä–µ–±–æ–≤–∞–Ω', 'requirement', '—É—Å–ª–æ–≤', 'condition',
        '—Å—Ä–æ–∫', 'deadline', '–¥–∞—Ç–∞', 'date', '–≤—Ä–µ–º–µ–Ω', 'time', '–ø–µ—Ä–∏–æ–¥', 'period',
        '–ø—Ä–∞–≤–∏–ª', 'rule', 'regulation', '–ø—Ä–æ—Ü–µ–¥—É—Ä', 'procedure', '–ø—Ä–æ—Ü–µ—Å—Å',
        'process', '–ø–æ—Ä—è–¥–æ–∫', 'order', '—ç—Ç–∞–ø', 'stage', '—à–∞–≥', 'step',
        '–ø–æ–¥–≥–æ—Ç–æ–≤–∫', 'preparation', '–≥–æ—Ç–æ–≤', 'ready', '–Ω–µ–æ–±—Ö–æ–¥–∏–º', 'necessary',
        '–æ–±—è–∑–∞—Ç–µ–ª—å–Ω', 'mandatory', '—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü', 'recommendation', '—Å–æ–≤–µ—Ç',
        'advice', '–∏–Ω—Å—Ç—Ä—É–∫—Ü', 'instruction', '—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤', 'guide', 'manual',
        '–≥–∞–π–¥', 'tutorial', '–ø—Ä–∏–º–µ—Ä', 'example', '–æ–±—Ä–∞–∑–µ—Ü', 'sample', '—à–∞–±–ª–æ–Ω',
        'template', '—Ñ–æ—Ä–º–∞', 'form', '–∞–Ω–∫–µ—Ç', 'questionnaire', '–æ–ø—Ä–æ—Å', 'survey'
    ],
    'international': [
        '–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω', 'international', '–∏–Ω–æ—Å—Ç—Ä–∞–Ω', 'foreign', '–∑–∞—Ä—É–±–µ–∂',
        'abroad', '–æ–±–º–µ–Ω', 'exchange', '–ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤', 'partnership',
        '—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤', 'cooperation', 'collaboration', '—è–∑—ã–∫', 'language',
        '–∞–Ω–≥–ª–∏–π—Å–∫', 'english', '–Ω–µ–º–µ—Ü–∫', 'german', '—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫', 'french',
        '–∫–∏—Ç–∞–π—Å–∫', 'chinese', '–ø–µ—Ä–µ–≤–æ–¥', 'translation', '–ª–æ–∫–∞–ª–∏–∑', 'localization',
        '–≤–∏–∑–∞', 'visa', '–¥–æ–∫—É–º–µ–Ω—Ç', 'document', '—Å—Ç—Ä–∞–Ω–æ–≤–µ–¥–µ–Ω', 'country studies',
        '–∫—É–ª—å—Ç—É—Ä', 'culture', '—Ç—Ä–∞–¥–∏—Ü', 'tradition', '–æ–±—ã—á–∞', 'custom',
        '–º–µ–Ω—Ç–∞–ª–∏—Ç–µ—Ç', 'mentality', '–∞–¥–∞–ø—Ç–∞—Ü', 'adaptation', '–∞–∫–∫–ª–∏–º–∞—Ç–∏–∑–∞—Ü',
        'acclimatization', '–ø–æ–¥–¥–µ—Ä–∂–∫', 'support', '–ø–æ–º–æ—â', 'help', 'assistance',
        '—Å–µ—Ä–≤–∏—Å', 'service', 'residence', '–ø—Ä–æ–∂–∏–≤–∞–Ω', 'living', '–±—ã—Ç', 'everyday life'
    ],
    'research': [
        '–Ω–∞—É—á–Ω', 'research', '–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω', 'study', '–∞–Ω–∞–ª–∏–∑', 'analysis',
        '—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç', 'experiment', '–ª–∞–±–æ—Ä–∞—Ç–æ—Ä', 'laboratory', 'lab',
        '–º–µ—Ç–æ–¥', 'method', 'methodology', '–ø–æ–¥—Ö–æ–¥', 'approach', '—Ç–µ–æ—Ä–∏',
        'theory', '–≥–∏–ø–æ—Ç–µ–∑', 'hypothesis', '–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω', 'assumption',
        '–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤', 'proof', 'evidence', '—Ä–µ–∑—É–ª—å—Ç–∞—Ç', 'result',
        '–≤—ã–≤–æ–¥', 'conclusion', '–∑–∞–∫–ª—é—á–µ–Ω', 'finding', '–æ—Ç–∫—Ä—ã—Ç', 'discovery',
        '–∏–Ω–Ω–æ–≤–∞—Ü', 'innovation', '—Ä–∞–∑—Ä–∞–±–æ—Ç–∫', 'development', '–ø–∞—Ç–µ–Ω—Ç',
        'patent', '–ø—É–±–ª–∏–∫–∞—Ü', 'publication', 'article', '—Å—Ç–∞—Ç—å', 'paper',
        '–¥–æ–∫–ª–∞–¥', 'report', '–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü', 'presentation', '–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü',
        'conference', '—Å–∏–º–ø–æ–∑–∏—É–º', 'symposium', '—Å–µ–º–∏–Ω–∞—Ä', 'seminar',
        '–∫–æ–ª–ª–æ–∫–≤–∏—É–º', 'colloquium', 'workshop', '–≤–æ—Ä–∫—à–æ–ø', '–¥–∏—Å–∫—É—Å—Å–∏',
        'discussion', '–¥–µ–±–∞—Ç', 'debate', '–ø–æ–ª–µ–º–∏–∫', 'controversy'
    ]
}

# –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
RECOMMENDATIONS = {
    'programming': {
        'ai': ['–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è', '–ì–ª—É–±–æ–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–í—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ GPU'],
        'ai_product': ['–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å)', '–ò–Ω–∂–µ–Ω–µ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö']
    },
    'math': {
        'ai': ['–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è', '–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'],
        'ai_product': ['–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', '–ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π –∞–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤']
    },
    'management': {
        'ai': ['–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –≤ Data Science'],
        'ai_product': ['–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç', '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–º –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º']
    },
    'data': {
        'ai': ['–û–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞', '–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ'],
        'ai_product': ['–ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞', '–ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏–∑']
    },
    'ai_interest': {
        'ai': ['–ù–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏', '–ì–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏', '–û–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞'],
        'ai_product': ['–ü—Ä–∏–∫–ª–∞–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ò–ò', 'UX –¥–ª—è AI-–ø—Ä–æ–¥—É–∫—Ç–æ–≤']
    }
}

# –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_states = {}


def get_elective_recommendations(background, program):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –≤—ã–±–æ—Ä–Ω—ã–º –∫—É—Ä—Å–∞–º"""
    program_data = ai_plan if program == 'ai' else ai_product_plan
    recommendations = []

    for category in background:
        if category in RECOMMENDATIONS:
            recommendations.extend(RECOMMENDATIONS[category].get(program, []))

    if len(recommendations) < 3:
        top_electives = sorted(
            [course for sem in program_data['semesters'].values() for course in sem
             if course.get('is_elective')],
            key=lambda x: x['hours'],
            reverse=True
        )[:5]
        recommendations.extend([c['name'] for c in top_electives])

    return list(set(recommendations))[:5]


def detect_background(text):
    """–ê–Ω–∞–ª–∏–∑ –±—ç–∫–≥—Ä–∞—É–Ω–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    background = []
    text_lower = text.lower()

    if any(word in text_lower for word in ['–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä', '–∫–æ–¥', 'sql', '–∞–ª–≥–æ—Ä–∏—Ç–º']):
        background.append('programming')
    if any(word in text_lower for word in ['–º–∞—Ç–µ–º', '—Å—Ç–∞—Ç', '–∞–Ω–∞–ª–∏–∑', '–∞–ª–≥–µ–±—Ä']):
        background.append('math')
    if any(word in text_lower for word in ['–º–µ–Ω–µ–¥–∂', '—É–ø—Ä–∞–≤–ª', '—Ä—É–∫–æ–≤–æ–¥', '–ª–∏–¥–µ—Ä']):
        background.append('management')
    if any(word in text_lower for word in ['–∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω', 'data', 'deep learning', 'ml']):
        background.append('data')
    if any(word in text_lower for word in ['–Ω–µ–π—Ä–æ—Å–µ—Ç', 'ai', '–∏–∏', '–º–∞—à–∏–Ω–Ω –æ–±—É—á–µ–Ω']):
        background.append('ai_interest')

    return background


def determine_best_program(background):
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    tech_score = sum(1 for cat in ['programming', 'math', 'data'] if cat in background)
    management_score = sum(1 for cat in ['management'] if cat in background)
    ai_interest_score = sum(1 for cat in ['ai_interest'] if cat in background)

    if tech_score >= 2 and ai_interest_score >= 1:
        return 'ai', "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å)"
    elif management_score >= 1 and ai_interest_score >= 1:
        return 'ai_product', "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–ò-–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ (–º–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∞—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å)"
    elif tech_score >= management_score:
        return 'ai', "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –±–∞–∑–∞)"
    else:
        return 'ai_product', "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–ò-–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ (—É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª)"


# –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
PROGRAMS_DESCRIPTION = """
üéì *–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—ã –ò–¢–ú–û*:

1. *–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç*:
   - –ì–ª—É–±–æ–∫–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ ML/DL
   - –ê–∫—Ü–µ–Ω—Ç –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏
   - –î–ª—è –±—É–¥—É—â–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ AI

2. *–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–ò-–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏*:
   - –ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –≤ AI
   - –ë–∏–∑–Ω–µ—Å-–∞—Å–ø–µ–∫—Ç—ã –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞
   - –î–ª—è –±—É–¥—É—â–∏—Ö –ø—Ä–æ–¥–∂–µ–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –≤ AI

*–û–ø–∏—à–∏—Ç–µ –≤–∞—à –æ–ø—ã—Ç –∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã, –∏ —è –ø–æ–¥–±–µ—Ä—É –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –∏ –∫—É—Ä—Å—ã!*
"""


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@bot.message_handler(commands=['start'])
def send_welcome(message):
    bot.send_message(message.chat.id, PROGRAMS_DESCRIPTION, parse_mode='Markdown')
    msg = bot.send_message(
        message.chat.id,
        "üìù *–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ:*\n"
        "- –í–∞—à –æ–ø—ã—Ç (–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –∏ —Ç.–¥.)\n"
        "- –ò–Ω—Ç–µ—Ä–µ—Å—ã –≤ –æ–±–ª–∞—Å—Ç–∏ –ò–ò\n"
        "- –ö–∞—Ä—å–µ—Ä–Ω—ã–µ —Ü–µ–ª–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)",
        parse_mode='Markdown'
    )
    user_states[message.chat.id] = {'state': 'waiting_background'}


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(func=lambda message: True)
def handle_text(message):
    chat_id = message.chat.id

    if chat_id in user_states and user_states[chat_id]['state'] == 'waiting_background':
        background = detect_background(message.text)

        if not background:
            bot.send_message(
                chat_id,
                "ü§î –ù–µ –º–æ–≥—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n"
                "'–ò–º–µ—é –æ–ø—ã—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Python –∏ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Å—å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏'\n"
                "'–†–∞–±–æ—Ç–∞–ª –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –∏ —Ö–æ—á—É –∏–∑—É—á–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ò–ò –≤ –±–∏–∑–Ω–µ—Å–µ'"
            )
            return

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É
        program, program_name = determine_best_program(background)
        recommendations = get_elective_recommendations(background, program)

        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
        response = (
                f"üéØ *–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –æ–ø—ã—Ç–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –±—É–¥–µ—Ç {program_name}*\n\n"
                f"üîπ *–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫—É—Ä—Å—ã:*\n" +
                "\n".join(f"‚Ä¢ {course}" for course in recommendations) +
                "\n\nüí° –°–æ–≤–µ—Ç: –û–±—Ä–∞—Ç–∏—Ç–µ –æ—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫—É—Ä—Å—ã –ø–æ " +
                ("—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∞—Å–ø–µ–∫—Ç–∞–º –ò–ò" if program == 'ai' else "—É–ø—Ä–∞–≤–ª–µ–Ω–∏—é AI-–ø—Ä–æ–¥—É–∫—Ç–∞–º–∏") +
                "\n\n–•–æ—Ç–∏—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã? –ù–∞–ø–∏—à–∏—Ç–µ /start"
        )

        bot.send_message(chat_id, response, parse_mode='Markdown')
        user_states.pop(chat_id, None)
        return

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    if any(keyword in message.text.lower() for keyword in RELEVANT_KEYWORDS['recommend']):
        bot.send_message(chat_id, "–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞–∂–º–∏—Ç–µ /start")
    else:
        bot.send_message(
            chat_id,
            "–Ø –ø–æ–º–æ–≥–∞—é —Å –≤—ã–±–æ—Ä–æ–º –º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—ã –ø–æ –ò–ò –≤ –ò–¢–ú–û. "
            "–ù–∞–∂–º–∏—Ç–µ /start –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π."
        )


# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == "__main__":
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    bot.polling(none_stop=True)